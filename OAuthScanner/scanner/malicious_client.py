from flask import Flask,request
from utils.utils import update_conf

app = Flask(__name__)

@app.route("/")
def starting_url():

    args = request.args
    
    if args:
        for val,cal in args.items():
                if val == "code":
                    f = True
                    update_conf("extracted_code", cal)
                    return '<div id="success">Malicious Client Got Response (check client\'s referrer log)</div>',200
                elif val == "error":
                    return cal, 400

@app.route("/callback")
def callback_url():

    args = request.args
    
    if args:
        for val,cal in args.items():
                if val == "code":
                    f = True
                    update_conf("extracted_code", cal)
                    return '<div id="success">Malicious Client Got Response (check client\'s referrer log)</div>',200
                elif val == "error":
                    return cal, 400


@app.route("/myapp")
def acallback_url():

    args = request.args
    
    if args:
        for val,cal in args.items():
                if val == "code":
                    f = True
                    update_conf("extracted_code", cal)
                    return '<div id="success">Malicious Client Got Response (check client\'s referrer log)</div>',200
                elif val == "error":
                    return cal, 404



if __name__ == '__main__':
    app.debug = True
    app.run(host="0.0.0.0", port=4200)
    app.run(debug=True)
